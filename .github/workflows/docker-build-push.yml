name: è‡ªå®šä¹‰æ™ºèƒ½é‡åŒ–é›†ç¾¤ OpenClaw é•œåƒ (Elvis Sun Swarm æ¶æ„)

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘æµ‹è¯•

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºå½“å‰å®šåˆ¶ç¯å¢ƒé…ç½®
        uses: actions/checkout@v4

      - name: æ”¶å– OpenClaw æœ€æ–°çš„å®˜æ–¹ä¸»å¹²æ ¸å¿ƒæºç ä½œä¸ºéª¨æ¶
        run: |
          # ï¼ˆä»¥é»˜è®¤çš„ä¸»å¹²ä»“åº“ä¸ºäº†ç¤ºä¾‹ï¼Œå¦‚æœåç»­æ‚¨çœ‹ä¸Šäº†å“ªä½å¤§ç‰›çš„ä»£ç ï¼Œç›´æ¥æŠŠå…‹éš†é“¾æ¥æ¢æˆä»–çš„ï¼‰
          git clone --depth=1 https://github.com/Darko/OpenClaw.git ./openclaw-src || true
          # ç”¨æˆ‘ä»¬ç‰¹æ„åŠ äº†é‡åŒ–å·¥å…·é“¾çš„ Dockerfile è¦†ç›–æ‰æ™®é€šåŸå§‹ç¯å¢ƒåŒ…
          cp ./Dockerfile ./openclaw-src/Dockerfile

      - name: è®¾ç½® Docker é«˜çº§äº‘ç«¯ Buildx æ”¯æŒ (æå¤§èŠ‚çº¦ç¼“å­˜ç©ºé—´)
        uses: docker/setup-buildx-action@v3

      - name: ç™»å½•åˆ° Docker Hub çš„ç§æœ‰å‚¨ç‰©æŸœ
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: ğŸ”¥ äº‘ç«¯æœåŠ¡å™¨ç«åŠ›å…¨å¼€å‘èµ·æ··åˆæ„å»ºå¹¶ä¸Šä¼ 
        uses: docker/build-push-action@v5
        with:
          context: ./openclaw-src
          push: true
          # åŠ¨æ€åŒ¹é…æ‚¨çš„ç”¨æˆ·åï¼Œæˆå“é•œåƒåŒ…é•¿è¿™æ ·ï¼šhurricane1983/openclaw-quant-swarm:latest
          tags: ${{ secrets.DOCKERHUB_USERNAME }}/openclaw-quant-swarm:latest
          # å……åˆ†åˆ©ç”¨ GitHub æä¾›çš„é«˜é€Ÿäº‘ç«¯ç¼“å­˜ï¼Œä¸‹æ¬¡æ„å»ºç§’å¼€
          cache-from: type=registry,ref=${{ secrets.DOCKERHUB_USERNAME }}/openclaw-quant-swarm:buildcache
          cache-to: type=registry,ref=${{ secrets.DOCKERHUB_USERNAME }}/openclaw-quant-swarm:buildcache,mode=max
